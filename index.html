<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Swicy Rush — Demo</title>
<link href="https://fonts.googleapis.com/css2?family=Chewy&family=Luckiest+Guy&family=Fredoka+One&family=Baloo+2:wght@600&family=Bangers&family=Bubblegum+Sans&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">


<style>
  :root{
    --accent:#87ceeb;
    --pink:#ff4da6;
    --bg1: linear-gradient(135deg,#ffdde1,#ee9ca7);
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg1);-webkit-font-smoothing:antialiased;}
  body{display:flex;align-items:center;justify-content:center;overflow:hidden;}

  #mainMenu{
    position:relative; z-index:20;
    width:400px; height:600px;
    border-radius:18px;
    background:rgba(255,255,255,0.95);
    box-shadow:0 12px 30px rgba(0,0,0,0.18),0 -6px 12px rgba(255,255,255,0.6);
    display:flex;flex-direction:column;align-items:center;justify-content:flex-start;
    padding-top:28px; gap:18px;
  }
 #mainMenu {
  position: relative; 
  z-index: 20;
  width: 90vw;           /* use viewport width */
  max-width: 400px;      /* limit maximum size */
  height: 80vh;          /* relative to viewport height */
  max-height: 600px;     
  border-radius: 18px;
  background: rgba(255,255,255,0.95);
  box-shadow: 0 12px 30px rgba(0,0,0,0.18), 0 -6px 12px rgba(255,255,255,0.6);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  padding-top: 20px;
  gap: 16px;
}

#mainMenu h1, #mainMenu h2 {
  margin: 0;        /* scales with viewport width */
  line-height: 1.1;
  color: var(--pink);
  letter-spacing: 1px;
  text-align: center;
}

 .menuBtn{
  width:78%;
  padding:.7vw 0;
  border-radius:999px;
  border:0;
  background:var(--pink);
  color:white;
  font-weight:700;
  font-size:16px;
  cursor:pointer;
  outline:none;
  transition:transform .12s ease,background .12s;
  }
  .menuBtn:hover{background:#ff80c0;transform:translateY(-3px);}


/* BOARD WRAP - CONTAINER FOR BOARD + BUTTON */
#boardWrap {
  position: absolute;
  top: 15%;    
  bottom: 15%;  
  left: 5%;
  right: 5%;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column; /* so back button can sit above or below easily */
}

/* INNER BOARD - RESPONSIVE GRID */
#innerBoard {
  position: relative; /* so back button can be positioned relative to this */
  width: 100%;
  max-width: 100%;
  aspect-ratio: 1 / 1; /* keeps it square */
  border-radius: 3%; 
  background: #e6e6e6;
  box-shadow:
    inset 0 2.5% 5% rgba(0,0,0,0.18),
    inset 0 -1.5% 3% rgba(0,0,0,0.08);
  
  display: grid;
  grid-template-columns: repeat(8, 1fr);
  grid-template-rows: repeat(8, 1fr);
  gap: 0.75%; 
  padding: 2%; 
  box-sizing: border-box;
}

#gameContainer{
    display:none; position:relative; z-index:10;
    width:85vmin; max-width:704px; height:85vmin; max-height:700px;
    border-radius:3%; background:#fff;
    box-shadow:0 12px 30px rgba(0,0,0,0.2),0 -6px 14px rgba(255,255,255,0.8);
    overflow:hidden;
  }

/* BACK BUTTON - ALIGNED TO INNERBOARD LEFT */
#backButton {
  position: absolute;
  top: 0;
  left: 0;
  border-radius: 0 0 12px 0;
  height:4%;
  padding: 0.5em 1em; 
  border: 0;
  background: var(--pink);
  color: white;
  font-weight: 700;
  font-size: clamp(5px, 2.5vw, 12px);
  cursor: pointer;
  transition: background 0.3s;
  
  display: flex;            
  justify-content: center; 
  align-items: center;     
  text-align: center;       
}

#backButton:hover {
  background: #ff80c0;
}


  #timerDisplay, #scoreDisplay, #movesDisplay{ 
  position:absolute; 
  bottom:0.5%; 
  font-weight:800; 
  color:var(--pink); 
  z-index:30; 
  font-size: 
  clamp(5px, 3vw, 18px); 
  color: 
  var(--pink); 
  z-index: 30; 
  text-align: center;}
  
  #timerDisplay { left: 5%; }
  #scoreDisplay { right: 5%; } 
  #movesDisplay { left: 5%;}

  
  #appWrapper {
  display: flex;
  flex-direction: column; /* stack vertically */
  align-items: center;
  gap: 20px;
  width: 90vw;
  max-width: 720px;
  padding: 20px 0;
}

.candy-text {
      font-size: 80px;
      color: #ff4da6;
      margin: 5px 0;
    }

    .candy-text span {
      display: inline-block;
      cursor: pointer;
      transition: color 0.3s ease, text-shadow 0.3s ease;
    }

    .candy-text span:hover {
      color: #ff1a75;
      text-shadow: 0 0 15px #ff99cc, 0 0 25px #ff4da6;
      animation: popBounce 0.4s ease;
    }

    @keyframes popBounce {
      0%   { transform: scale(1); }
      40%  { transform: scale(1.5); }
      60%  { transform: scale(0.9); }
      80%  { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    /* Font classes */
    .chewy    { font-family: 'Chewy', cursive; }
    .luckiest { font-family: 'Luckiest Guy', cursive; }
    .fredoka  { font-family: 'Fredoka One', cursive; }
    .baloo    { font-family: 'Baloo 2', cursive; }
    .bangers  { font-family: 'Bangers', cursive; }
    .bubble   { font-family: 'Bubblegum Sans', cursive; }


.candy-animation {
  display: flex;
  gap: 10px;
}

.candy {
  font-size: 28px;
  display: inline-block;
  animation: bounceCandy 1s infinite ease-in-out;
}

.candy-img {
   width: clamp(30px, 5vw, 50px); /* min 30px, scales with screen, max 50px */
}

.candy:nth-child(1) { animation-delay: 0s; }
.candy:nth-child(2) { animation-delay: 0.1s; }
.candy:nth-child(3) { animation-delay: 0.2s; }
.candy:nth-child(4) { animation-delay: 0.3s; }
.candy:nth-child(5) { animation-delay: 0.4s; }
.candy:nth-child(6) { animation-delay: 0.5s; }
.candy:nth-child(7) { animation-delay: 0.6s; }
.candy:nth-child(8) { animation-delay: 0.7s; }

@keyframes bounceCandy {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-12px) rotate(-10deg); }
}
#mechanicsModal .modal-dialog {
  max-width: 800px; /* adjust width as needed */
  width: 90%;       /* responsive for smaller screens */
}


.floating-score {
  position: absolute;
  font-weight: 800;
  color: var(--pink);
  font-size: 20px;         /* bigger for visibility */
  pointer-events: none;
  animation: floatUp 0.8s ease forwards;
  text-shadow: 0 0 6px #fff, 0 0 10px #ff4da6;
}

@keyframes floatUp {
  0% { transform: translateY(0) scale(1); opacity: 1; }
  50% { transform: translateY(-20px) scale(1.3); opacity: 1; }
  100% { transform: translateY(-40px) scale(1); opacity: 0; }
}

#shuffleOverlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  backdrop-filter: blur(6px); /* blur the innerBoard */
  background: rgba(255,255,255,0.5); /* semi-transparent overlay */
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.8rem;
  font-weight: 700;
  color: var(--pink);
  z-index: 50;
  border-radius: 14px;
  text-align: center;
  padding: 10px;
  opacity: 0;
  pointer-events: none; /* don't block clicks */
  transition: opacity 0.3s ease;
}
#floatingCandies {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  overflow: hidden;
  z-index: 5;
}

.floating-candy {
    position: absolute;
    width: 40px;
    height: 40px;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.5s ease;
  }

  @keyframes riseFall {
    0% {
      transform: translateY(0) rotate(0deg);
      opacity: 0;
    }
    10% {
      opacity: 1;
    }
    50% {
      transform: translateY(50vh) rotate(180deg);
      opacity: 1;
    }
    90% {
      opacity: 1;
    }
    100% {
      transform: translateY(100vh) rotate(360deg);
      opacity: 0;
    }
  }

@keyframes glowPulse {
  0% { box-shadow: 0 0 10px 2px rgba(135, 206, 250, 0.6); }
  50% { box-shadow: 0 0 16px 4px rgba(135, 206, 250, 0.9); }
  100% { box-shadow: 0 0 10px 2px rgba(135, 206, 250, 0.6); }
}

@keyframes hoverPulse {
  0% { box-shadow: 0 0 6px 1px rgba(135, 206, 250, 0.4); }
  50% { box-shadow: 0 0 10px 2px rgba(135, 206, 250, 0.6); }
  100% { box-shadow: 0 0 6px 1px rgba(135, 206, 250, 0.4); }
}

.tile:hover {
  animation: hoverPulse 0.6s infinite ease-in-out;
}

.tile.selected {
  animation: glowPulse 1s infinite ease-in-out;
}

@keyframes subtleShake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-2px); }
  50% { transform: translateX(2px); }
  75% { transform: translateX(-1px); }
}

.tile.shake {
  animation: subtleShake 0.25s ease;
}

  .tile {
    background:white;
    position:relative; overflow:hidden;
    display:flex;align-items:center;justify-content:center;
    border-radius:10px; cursor:pointer; user-select:none;
    transition: transform .12s ease, box-shadow .12s ease;
  }
  .tileImg{
    width:100%;height:100%;border-radius:10px; object-fit:cover;
  }

  .tile:hover, .tile.selected { transform:scale(1.06); box-shadow: 0 0 12px 4px rgba(135, 206, 250, 0.6); }

  @keyframes matchPop {0%{transform:scale(1);opacity:1;}50%{transform:scale(1.2);opacity:.8;}100%{transform:scale(0);opacity:0;}}
  .tile.matching { animation: matchPop .4s ease forwards; }

  .tile.selected { box-shadow: 0 0 16px 6px rgba(135, 206, 250, 0.8); }	
  @keyframes shake{0%,100%{transform:translateX(0);}25%{transform:translateX(-4px);}50%{transform:translateX(4px);}75%{transform:translateX(-2px);}}
  }
  
  @keyframes floatUp {
    0% { transform: translateY(0); opacity: 1; }
    100% { transform: translateY(-28px); opacity: 0; }
  }



/* Music Player */

#musicPlayerBox {
    display: none;
    width: 70vmin;
    max-width: 580px;
    height: auto;               /* automatically adjust to content */
    max-height: 90vh;           /* optional: prevent it from being too tall */
    border-radius: 20px;
    background: #fff;
    box-shadow: 0 12px 30px rgba(0,0,0,0.2), 0 -6px 14px rgba(255,255,255,0.8);
    overflow: visible;           /* hides overflowing content */
    padding: 1em;               /* optional: give inner spacing */
    flex-direction: column;     /* stack objects vertically */
    gap: 0.5em;                 /* spacing between objects */
}
  
.progress {
    height: clamp(4px, 0.5vw, 6px); /* responsive height */
    margin: clamp(1%, 1vw, 1%) 0; /* responsive vertical spacing */
    border-radius: 4px;
    background: #ffb6c1; /* optional: make it visible */
}

.progress-bar {
    height: 100%; /* fill the progress container */
    transition: width 0.2s linear;
}
	
	.music-box {
      width: 100%;
      background: #fff;
      border-radius: 16px;
      padding: 0px;
      text-align: center;
    }

.btn-circle {
    border-radius: 50% !important;
    width: clamp(40px, 6vmin, 60px);  /* scales with viewport */
    height: clamp(40px, 6vmin, 60px);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: clamp(14px, 2vmin, 22px); /* responsive icon size */
    margin: 1vmin;
    cursor: pointer;
    transition: transform 0.2s ease;
}

.btn-circle:hover {
    transform: scale(1.1);
}
	
.dropup .dropdown-menu {
  background: #1c1c1c;          /* dark background */
  border: 2px solid #ff69b4;    /* pink outline */
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(255,105,180,0.4);
  padding: 0.5rem 0;
  min-width: 200px;
  color: #ff69b4;               /* text default color pink */
}

/* Dropdown items */
.dropup .dropdown-item {
  color: #ff69b4;               /* pink text by default */
  padding: 0.5rem 1rem;
  background: transparent;      /* no gray background */
  transition: background 0.2s, color 0.2s;
}

.dropup .dropdown-item:hover,
.dropup .dropdown-item:focus {
  background: #ff69b4;           /* pink highlight */
  color: #1c1c1c;                /* dark text for contrast */
}

/* Optional: scrollable list */
.dropup .dropdown-menu {
  max-height: 250px;
  overflow-y: auto;
}

/* Pink-themed scrollbar */
.dropup .dropdown-menu::-webkit-scrollbar {
  width: 8px;
}

.dropup .dropdown-menu::-webkit-scrollbar-track {
  background: #1c1c1c;
  border-radius: 8px;
}

.dropup .dropdown-menu::-webkit-scrollbar-thumb {
  background-color: #ff69b4;
  border-radius: 8px;
  border: 2px solid #1c1c1c;
}

/* Pink border for the dropup button */
.btn-outline-secondary.dropdown-toggle {
  border-color: #ff69b4;       /* pink border */
  color: #ff69b4;              /* optional: pink text */
  background: transparent;      /* keep it transparent like outline */
  transition: all 0.2s;
}

.btn-outline-secondary.dropdown-toggle:hover,
.btn-outline-secondary.dropdown-toggle:focus {
  background-color: #ff69b4;   /* pink background on hover */
  color: #1c1c1c;              /* dark text for contrast */
  border-color: #ff69b4;       /* keep border pink on hover */
}


	/* Candy Volume Slider */
#volumeSlider {
  -webkit-appearance: none;
  width: 100%;
  height: clamp(6px, 1vw, 12px);
  border-radius: 999px;
  background: linear-gradient(90deg, #ff4da6, #ffb6c1); /* pink gradient only */
  outline: none;
  transition: box-shadow 0.2s ease;
}

#volumeSlider:hover {
  box-shadow: 0 0 clamp(6px, 1vw, 10px) rgba(255, 77, 166, 0.6),
              0 0 clamp(6px, 1vw, 10px) rgba(255, 182, 193, 0.6);
}

/* Thumb / knob */
#volumeSlider::-webkit-slider-thumb {
  -webkit-appearance: none; /* remove default style */
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: white;        /* knob color */
  border: 2px solid #ff4da6;
  cursor: pointer;
  box-shadow: none;         /* remove default blue shadow */
  transition: transform 0.15s ease, background 0.2s ease;
}

/* Hover effect on knob */
#volumeSlider::-webkit-slider-thumb:hover,
#volumeSlider::-moz-range-thumb:hover {
  background: white;        
  border: 2px solid #ff4da6; 
  transform: scale(1.1);
}

#volumeSlider::-webkit-slider-thumb:hover {
  transform: scale(1.2);
}

#volumeSlider:focus::-webkit-slider-thumb {
  box-shadow: none;        
  background: white;
  border: 2px solid #ff4da6;
}

#songTitle {
    width: 80%;                           
    max-width: 400px;                     
    font-size: clamp(12px, 1.5vw, 16px);  
    margin: 1% auto 0 auto;
    text-align: center;
    border-radius: 0.5em;
    background: #f5f5f5;
    height: 3em;                
    line-height: 3em;            
    min-height: 2em;                      
    overflow: hidden;                     
    white-space: nowrap;                   
    text-overflow: ellipsis;               
}
.music-controls {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: clamp(8px, 2vw, 20px); /* spacing scales with viewport */
  margin: clamp(4px, 1vw, 12px) 0; /* top & bottom spacing scales */
}

.music-player-row {
  display: flex;
  align-items: center;
  justify-content: space-between; /* left, center, right */
  width: 100%;
  gap: 1em; /* optional spacing */
  box-sizing: border-box;
}

.music-player-left {
  display: flex;
  justify-content: flex-start;
  align-items: center;
}

.music-player-center {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: clamp(8px, 2vw, 20px);
}

.music-player-right {
  display: flex;
  justify-content: flex-end;
  align-items: center;
  gap: 0.5em;
  width: 100px; /* optional fixed width for slider + icons */
}


.btn-candy {
  border: none;
  border-radius: 50%;
  width: clamp(36px, 6vw, 60px);   
  height: clamp(36px, 6vw, 60px);
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: clamp(16px, 3vw, 28px); 
  background-color: var(--pink);
  color: white;
  cursor: pointer;
  transition: transform 0.2s ease;
}
.btn-candy:hover {
  transform: scale(1.1);
}
.btn-candy:active {
  transform: scale(0.95);
}

.modal-body {
  padding: clamp(10px, 2vw, 30px); 
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  max-width: 90vw;
  margin: 0 auto;
  box-sizing: border-box;
}


</style>
</head>
<body>
<div id="floatingCandies"></div>
<div id="appWrapper">
<section id="mainMenu" aria-label="Main menu">
  <h2 class="candy-text bangers">
    <span>S</span><span>w</span><span>i</span><span>c</span><span>y</span> <span>R</span><span>u</span><span>s</span><span>h</span>
  </h2>
  
  <button id="classicBtn" class="menuBtn">Classic</button>
  <button id="hurryBtn" class="menuBtn">Hurry Hurry</button>
  <button id="dizzyBtn" class="menuBtn">Dizzy Dizzy</button>
  <button id="swishBtn" class="menuBtn">Swish and Match</button>
  <button id="mechanicsBtn" class="menuBtn">Mechanics</button>
  <button id="leaderBtn" class="menuBtn">Leaderboard</button>
  <b>Demo Version</b>
  
</section>


<div class="modal fade" id="mechanicsModal" tabindex="-1" aria-labelledby="mechanicsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="border-radius:16px;">
      <div class="modal-header">
        <h5 class="modal-title" id="mechanicsModalLabel">Game Mechanics</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
		<div class="candy-animation d-flex justify-content-center mb-3">
			<img src="images/candy1.png" class="candy-img candy" alt="Candy 1">
			<img src="images/candy2.png" class="candy-img candy" alt="Candy 2">
			<img src="images/candy3.png" class="candy-img candy" alt="Candy 3">
			<img src="images/candy4.png" class="candy-img candy" alt="Candy 4">
			<img src="images/candy5.png" class="candy-img candy" alt="Candy 5">
			<img src="images/candy6.png" class="candy-img candy" alt="Candy 6">
			<img src="images/candy7.png" class="candy-img candy" alt="Candy 7">
			<img src="images/candy8.png" class="candy-img candy" alt="Candy 8">
		</div>
		
       <strong>Classic</strong>Match candies at your own pace.
       <strong>Hurry Hurry</strong> Score as much as you can before time runs out!
       <strong>Dizzy Dizzy</strong> Candies randomly shuffle, stay sharp!
       <strong>Swish and Match</strong> Match special a Special Candy and get extra move! 
	   <p></p><p></p>
	   <img src="images/ban4n400.png" class="candy-img" alt="Candy 9"> 
      
		
		<p><strong>Developed By:</strong> @BaN4N4000</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">OK</button>
      </div>
    </div>
  </div>
</div>



<section id="gameContainer" aria-hidden="true">
<div id="shuffleOverlay">No more Tiles to Match!<br>Shuffling...</div>
   <button id="backButton">❮❮ Back</button>
  <div id="timerDisplay">Time: ∞</div>
  <div id="scoreDisplay">Score: 0</div>
   <div id="boardWrap">
    <div id="innerBoard" role="grid" aria-label="Game board"></div>
	
	
  </div>
 
</section>
<section>

<div id="musicPlayerBox" class="container">
  <div class="music-box">
  <h4 id="songTitle">Select a Song</h4>
  
  <audio id="audioPlayer" preload="auto"></audio>
  
  <!-- Progress bar -->
  <div class="progress">
    <div id="progressBar" class="progress-bar bg-danger" style="width: 0%;"></div>
  </div>

<div class="music-player-row">
  <!-- LEFT: Dropup -->
  <div class="music-player-left">
    <div class="dropup">
      <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
        Song List
      </button>
      <ul class="dropdown-menu" id="songList">
        <!-- dynamically generated songs -->
      </ul>
    </div>
  </div>

  <!-- CENTER: Music Controls -->
  <div class="music-player-center">
    <button class="btn-candy" id="prevBtn"><i class="bi bi-skip-backward-fill"></i></button>
    <button class="btn-candy" id="playBtn"><i class="bi bi-play-fill"></i></button>
    <button class="btn-candy" id="nextBtn"><i class="bi bi-skip-forward-fill"></i></button>
  </div>

  <!-- RIGHT: Volume -->
  <div class="music-player-right">
    <i class="bi bi-volume-down"></i>
    <input type="range" id="volumeSlider" min="0" max="100" value="70" class="flex-grow-1">
    <i class="bi bi-volume-up"></i>
  </div>
</div>

 
 

  
  
</div>

</div>

</section>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>

//Rise and Fall Candies
const candyImages = [
  'images/candy1.png','images/candy2.png','images/candy3.png',
  'images/candy4.png','images/candy5.png','images/candy6.png',
  'images/candy7.png','images/candy8.png'
];

function spawnCandy() {
  const candy = document.createElement('img');
  candy.src = candyImages[Math.floor(Math.random() * candyImages.length)];
  candy.className = 'floating-candy';

  const candyWidth = 40; // match CSS
  candy.style.left = Math.random() * (window.innerWidth - candyWidth) + 'px';

  // randomly decide if it rises or falls
  const direction = Math.random() < 0.5 ? 'fall' : 'rise';
  const distance = direction === 'fall' ? window.innerHeight : -window.innerHeight;

  const duration = Math.random() * 5 + 5; // 5-10s
  candy.style.animation = `riseFall ${duration}s linear forwards`;

  if(direction === 'rise') candy.style.transform = `translateY(${window.innerHeight}px)`;

  document.body.appendChild(candy);

  // Remove element after animation completes
  candy.addEventListener('animationend', () => {
    candy.remove();
  });
}

// spawn new candy every 0.3-0.7 seconds
setInterval(spawnCandy, 400);



//Possible Moves checker

function hasPossibleMoves() {
  for (let r = 0; r < ROWS; r++) {
    for (let c = 0; c < COLS; c++) {
      const val = board[r][c];

      // Check swap with right neighbor
      if (c < COLS - 1) {
        [board[r][c], board[r][c + 1]] = [board[r][c + 1], board[r][c]];
        if (findAllMatches().length > 0) {
          [board[r][c], board[r][c + 1]] = [board[r][c + 1], board[r][c]];
          return true;
        }
        [board[r][c], board[r][c + 1]] = [board[r][c + 1], board[r][c]];
      }

      // Check swap with bottom neighbor
      if (r < ROWS - 1) {
        [board[r][c], board[r + 1][c]] = [board[r + 1][c], board[r][c]];
        if (findAllMatches().length > 0) {
          [board[r][c], board[r + 1][c]] = [board[r + 1][c], board[r][c]];
          return true;
        }
        [board[r][c], board[r + 1][c]] = [board[r + 1][c], board[r][c]];
      }
    }
  }
  return false;
}

//Tile Shuffler
function shuffleBoard() {
  // Flatten board, shuffle array, then rebuild 2D board
  const flat = board.flat();
  for (let i = flat.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [flat[i], flat[j]] = [flat[j], flat[i]];
  }

  for (let r = 0; r < ROWS; r++) {
    for (let c = 0; c < COLS; c++) {
      board[r][c] = flat[r * COLS + c];
    }
  }

  renderWholeBoard();
}

function showShuffleOverlay(duration = 1000) {
  const overlay = document.getElementById('shuffleOverlay');
  overlay.style.opacity = 1;

  setTimeout(() => {
    overlay.style.opacity = 0;
  }, duration);
}


const mechanicsBtn = document.getElementById("mechanicsBtn");
const mechanicsModal = new bootstrap.Modal(document.getElementById('mechanicsModal'));

mechanicsBtn.addEventListener("click", () => {
  mechanicsModal.show();
});


const ROWS = 8, COLS = 8;
const IMAGE_PREFIX = 'images/candy';
const BONUS_IMAGE = 'images/bonuscandy.png';

const bonusSound = new Audio("sounds/soundeffects/kwengkweng.mp3");
bonusSound.volume = 1; // adjust if too loud

const matchSound = new Audio("sounds/soundeffects/sfx2.mp3");
matchSound.volume = 1; // adjust volume

const hurryBonusSound = new Audio("sounds/soundeffects/sfx1.mp3");
hurryBonusSound.volume = 1; // adjust volume if needed

const invalidMatchSound = new Audio('sounds/soundeffects/sfx3.mp3');
const timeUpSound = new Audio('sounds/soundeffects/sfx4.mp3');
const noMovesLeftSound = new Audio('sounds/soundeffects/sfx4.mp3');


let board = [], score = 0, firstSelection = null, dragSource = null;
let mode = null, movesLeft = 0, timerValue = 0;
let timerInterval = null, dizzyInterval = null;

const mainMenu = document.getElementById('mainMenu');
const gameContainer = document.getElementById('gameContainer');
const innerBoard = document.getElementById('innerBoard');
const scoreDisplay = document.getElementById('scoreDisplay');
const timerDisplay = document.getElementById('timerDisplay');

function randInt(min, max){ return Math.floor(Math.random() * (max - min + 1)) + min; }
function randomCandyValue(){ return (mode === 'Swish and Match') ? randInt(1, 9) : randInt(1, 8); }

function createTileElement(r, c, val){
  const tile = document.createElement('div');
  tile.className = 'tile';
  tile.dataset.r = r; tile.dataset.c = c;
  tile.draggable = true;

  const img = document.createElement('img');
  img.className = 'tileImg';
  img.src = (val === 9) ? BONUS_IMAGE : `${IMAGE_PREFIX}${val}.png`;
  tile.appendChild(img);

  tile.addEventListener('click', () => onTileClick(r, c));
  tile.addEventListener('dragstart', () => { dragSource = { r, c }; });
  tile.addEventListener('dragover', e => e.preventDefault());
  tile.addEventListener('drop', () => { if(dragSource) onTileDrop(r, c); dragSource = null; });

  return tile;
}

function spawnFloatingScore(r, c, points) {
  const tile = tileDomAt(r, c);
  if(!tile) return;

  const tileRect = tile.getBoundingClientRect();
  const boardRect = boardWrap.getBoundingClientRect();

  const scoreEl = document.createElement('div');
  scoreEl.className = 'floating-score';
  scoreEl.textContent = `+${points}`;

  // position relative to boardWrap
  scoreEl.style.position = 'absolute';
  scoreEl.style.left = `${tileRect.left - boardRect.left + tileRect.width/2 - 12}px`;
  scoreEl.style.top = `${tileRect.top - boardRect.top}px`;

  boardWrap.appendChild(scoreEl);

  setTimeout(() => {
    if(scoreEl.parentElement) scoreEl.parentElement.removeChild(scoreEl);
  }, 800); // animation duration
}

function createBoardInitial(){
  board = [];
  for(let r=0; r<ROWS; r++){
    const row = [];
    for(let c=0; c<COLS; c++) row.push(randomCandyValue());
    board.push(row);
  }
  renderWholeBoard();
  setTimeout(() => resolveMatchesAndCascade(true), 50);
}

function renderWholeBoard(){
  innerBoard.innerHTML = '';
  for(let r=0; r<ROWS; r++){
    for(let c=0; c<COLS; c++){
      innerBoard.appendChild(createTileElement(r, c, board[r][c]));
    }
  }
}

function tileDomAt(r,c){ return innerBoard.querySelector(`.tile[data-r="${r}"][data-c="${c}"]`); }
function areAdjacent(a,b){ return Math.abs(a.r-b.r)+Math.abs(a.c-b.c)===1; }

function swapAndResolve(a,b){
  [board[a.r][a.c], board[b.r][b.c]] = [board[b.r][b.c], board[a.r][a.c]];
  renderWholeBoard();
  const matches = findAllMatches();
  if(matches.length === 0){
    setTimeout(() => {
	  invalidMatchSound.currentTime = 0;
      invalidMatchSound.play();
	  
      [board[a.r][a.c], board[b.r][b.c]] = [board[b.r][b.c], board[a.r][a.c]];
      renderWholeBoard();
      tileDomAt(a.r,a.c)?.classList.add('shake');
      tileDomAt(b.r,b.c)?.classList.add('shake');
      setTimeout(() => {
        tileDomAt(a.r,a.c)?.classList.remove('shake');
        tileDomAt(b.r,b.c)?.classList.remove('shake');
      }, 300);
    }, 160);
  } else resolveMatchesAndCascade(false);
}

function findAllMatches(){
  const matched = [];
  for(let r=0;r<ROWS;r++){
    let runVal=board[r][0], runCount=1;
    for(let c=1;c<COLS;c++){
      if(board[r][c]===runVal) runCount++;
      else {
        if(runCount>=3) for(let k=0;k<runCount;k++) matched.push({r, c:c-1-k});
        runVal=board[r][c]; runCount=1;
      }
    }
    if(runCount>=3) for(let k=0;k<runCount;k++) matched.push({r, c:COLS-1-k});
  }
  for(let c=0;c<COLS;c++){
    let runVal=board[0][c], runCount=1;
    for(let r=1;r<ROWS;r++){
      if(board[r][c]===runVal) runCount++;
      else{
        if(runCount>=3) for(let k=0;k<runCount;k++) matched.push({r:r-1-k,c});
        runVal=board[r][c]; runCount=1;
      }
    }
    if(runCount>=3) for(let k=0;k<runCount;k++) matched.push({r:ROWS-1-k,c});
  }
  const seen = new Set(), unique = [];
  for(const m of matched){
    const key = `${m.r},${m.c}`;
    if(!seen.has(key)){seen.add(key); unique.push(m);}
  }
  return unique;
}

function updateHUD(){
  scoreDisplay.textContent = `Score: ${score}`;

  if(mode==='Hurry Hurry'){
    const minutes = Math.floor(timerValue / 60);
    const seconds = timerValue % 60;
    timerDisplay.textContent = `Time: ${minutes}:${seconds.toString().padStart(2,'0')}`;
  }
  else if(mode==='Swish and Match') timerDisplay.textContent = `Moves: ${movesLeft}`;
  else if(mode==='Dizzy Dizzy'){
    timerDisplay.textContent = ''; // 👈 hide moves/timer in Dizzy
  }
  else {
    timerDisplay.textContent = '';
  }
}

function startTimer(){
  clearInterval(timerInterval);
  if(mode==='Hurry Hurry') timerValue=120;
  else timerValue=999;
  timerInterval=setInterval(()=>{
    if(mode==='Hurry Hurry'){
      timerValue--;
      updateHUD();
if(timerValue<=0){
  timeUpSound.currentTime = 0;
  timeUpSound.play(); 
  clearInterval(timerInterval); 
  gameOver("Time's up!");
}
    }
  },1000);
}

function resolveMatchesAndCascade(initialFlag){

  const matches = findAllMatches();
  if(matches.length === 0) return;

  // Add animation
  matches.forEach(pos => tileDomAt(pos.r, pos.c)?.classList.add('matching'));

  setTimeout(() => {
    const matchedValues = [];
    let suppressMatchSound = false; // 👈 new flag

    matches.forEach(pos => {
      const val = board[pos.r][pos.c];
      matchedValues.push(val);

      score += 10;
      spawnFloatingScore(pos.r, pos.c, 10);
      board[pos.r][pos.c] = null;
    });

    // Hurry Hurry: add 10s every 150 score
    if(mode === 'Hurry Hurry'){
      const scoreBonus = Math.floor(score / 150) * 10;
      const previousBonus = Math.floor((score - matches.length*10) / 150) * 10;
      const addedTime = scoreBonus - previousBonus;

      if(addedTime > 0){
        timerValue += addedTime;
        hurryBonusSound.currentTime = 0;
        hurryBonusSound.play();

        suppressMatchSound = true; // 👈 mute regular match sound
      }
    }

    // Regular match sound
    if(matches.length > 0 && !suppressMatchSound){
      matchSound.currentTime = 0;
      matchSound.play();
    }

    //  Swish and Match move handling
    if(mode === 'Swish and Match'){
      const bonusCount = matchedValues.filter(v => v === 9).length;
      if(bonusCount > 0){
        movesLeft += bonusCount;
        bonusSound.currentTime = 0;
        bonusSound.play();
      } else {
        movesLeft--;
      }
    }
	if(mode === 'Swish and Match' && movesLeft <= 0){
	    gameOver('No Move Left!');
	}

    updateHUD();
    collapseAndRefill();

    setTimeout(() => {
      resolveMatchesAndCascade(false);

      // Check for possible moves
		if (!hasPossibleMoves()) {
			showShuffleOverlay(1200); // show overlay
			setTimeout(() => shuffleBoard(), 300); // shuffle after short delay
		}
    }, 120);

  }, 400);
}

//Cascade Helper

function gameOver(reason) {
  clearInterval(timerInterval);
  clearInterval(dizzyInterval);
  noMovesLeftSound.currentTime = 0;
  noMovesLeftSound.play();
  
  alert(`Game Over! ${reason}\n Your total score: ${score}`);
  showMenu();
  
}


function collapseAndRefill(){
  for(let c=0;c<COLS;c++){
    const stack=[];
    for(let r=ROWS-1;r>=0;r--) if(board[r][c]!=null) stack.push(board[r][c]);
    while(stack.length<ROWS) stack.push(randomCandyValue());
    for(let r=ROWS-1,i=0;r>=0;r--,i++) board[r][c]=stack[i];
  }
  renderWholeBoard();
}

// Update your onTileClick function to handle persistent glow
function onTileClick(r, c){
  const clickedTile = tileDomAt(r, c);

  if(firstSelection){
    if(firstSelection.r===r && firstSelection.c===c){
      firstSelection=null;
      clickedTile.classList.remove('selected'); // remove glow if unselecting
      return;
    }

    if(areAdjacent(firstSelection,{r,c})){
      swapAndResolve(firstSelection,{r,c});
     // Check if either tile is bonus
	const valA = board[firstSelection.r][firstSelection.c];
	const valB = board[r][c];
	const isBonusSwap = (valA === 9 || valB === 9);
      updateHUD();

      // Remove glow after attempting match
      tileDomAt(firstSelection.r, firstSelection.c)?.classList.remove('selected');
      clickedTile.classList.remove('selected');
    }else {
      // Invalid non-adjacent selection: vibrate both tiles
      const tileA = tileDomAt(firstSelection.r, firstSelection.c);
      const tileB = tileDomAt(r, c);
      tileA?.classList.add('shake');
      tileB?.classList.add('shake');
      setTimeout(() => {
        tileA?.classList.remove('shake');
        tileB?.classList.remove('shake');
      }, 250);
    }	
    firstSelection=null;
  } else {
    firstSelection={r,c};
    clickedTile.classList.add('selected'); // keep glow when selected
  }
}

function onTileDrop(r, c) {
  if (dragSource) {
    if (areAdjacent(dragSource, { r, c })) {
      swapAndResolve(dragSource, { r, c });
	  const valA = board[dragSource.r][dragSource.c];
	  const valB = board[r][c];
	  const isBonusSwap = (valA === 9 || valB === 9);
      updateHUD();
    } else {
      // Invalid drag: vibrate both tiles
      const tileA = tileDomAt(dragSource.r, dragSource.c);
      const tileB = tileDomAt(r, c);
      tileA?.classList.add('shake');
      tileB?.classList.add('shake');
      setTimeout(() => {
        tileA?.classList.remove('shake');
        tileB?.classList.remove('shake');
      }, 250);
    }
  }
  dragSource = null;
}


function startDizzy(){
  clearInterval(dizzyInterval);
  dizzyInterval=setInterval(()=>{
    for(let r=0;r<ROWS;r++){
      for(let c=0;c<COLS;c++){
        if(Math.random()<0.08){
          board[r][c]=randomCandyValue();
          const t=tileDomAt(r,c);
          if(t){
            t.classList.add('matching');
            setTimeout(()=>{ t.classList.remove('matching'); renderWholeBoard(); }, 300);
          }
        }
      }
    }
  }, 2000);
}

function showMenu(){
  stopMusic();
  mainMenu.style.display='flex';
  gameContainer.style.display='none';
  musicPlayerBox.style.display='none';
  clearInterval(timerInterval);
  clearInterval(dizzyInterval);
}

function startGame(selectedMode){
  startMusic();
  mode = selectedMode;
  score = 0; movesLeft = 20; firstSelection=null;
  mainMenu.style.display='none';
  gameContainer.style.display='block';
  musicPlayerBox.style.display='block';
  createBoardInitial();
  updateHUD();
  if(mode==='Hurry Hurry') startTimer();
  else if(mode==='Dizzy Dizzy') startDizzy();
}

document.getElementById('classicBtn').onclick = ()=>startGame('Classic');
document.getElementById('hurryBtn').onclick = ()=>startGame('Hurry Hurry');
document.getElementById('dizzyBtn').onclick = ()=>startGame('Dizzy Dizzy');
document.getElementById('swishBtn').onclick = ()=>startGame('Swish and Match');
document.getElementById('backButton').onclick = ()=>showMenu();
document.getElementById('leaderBtn').onclick = ()=>alert('Leaderboard not implemented yet.');


const songs = [
  { title: "Butterfly's Dream", file: "sounds/Butterflys Dream.mp3" },
  { title: "Curious", file: "sounds/Curious.mp3" },
  { title: "Dating Myself", file: "sounds/Dating Myself.mp3" },
  { title: "DDANG!", file: "sounds/DDANG!.mp3" },
  { title: "Dopamine", file: "sounds/Dopamine.mp3" },
  { title: "Dream of Girls", file: "sounds/Dream of Girls.mp3" },
  { title: "From The Seed Called Hey Whats Up", file: "sounds/From The Seed Called Hey Whats Up.mp3" },
  { title: "Good Feeling", file: "sounds/Good Feeling.mp3" },
  { title: "Moshi Moshi EN ver.", file: "sounds/Moshi Moshi EN ver..mp3" },
  { title: "Moshi Moshi JP ver.", file: "sounds/Moshi Moshi JP ver..mp3" },
  { title: "Poppin", file: "sounds/Poppin.mp3" },
  { title: "See you in my dream (꿈에서 또 만나)", file: "sounds/See you in my dream (꿈에서 또 만나).mp3" },
  { title: "Shaking My Head", file: "sounds/Shaking My Head.mp3" },
  { title: "Spring Rain", file: "sounds/Spring Rain.mp3" },
  { title: "Superwoman", file: "sounds/Superwoman.mp3" },
  { title: "Swicy", file: "sounds/SWICY.mp3" },
  { title: "Watchu Need", file: "sounds/Watchu Need.mp3" }
];


let currentSongIndex = 0;
let isPlaying = false;
const audio = new Audio();

const volumeSlider = document.getElementById("volumeSlider");
if (volumeSlider) {
  // set initial audio volume from slider (0-100 -> 0.0-1.0)
  audio.volume = +volumeSlider.value / 100;

  // sync bonus SFX initial volume if present
  if (window.bonusSound) window.bonusSound.volume = audio.volume;

  // update volumes in real time
  volumeSlider.addEventListener("input", (e) => {
    const vol = +e.target.value / 100;
    audio.volume = vol;
    if (window.bonusSound) window.bonusSound.volume = vol;
  });
}


const playBtn = document.getElementById("playBtn");
const prevBtn = document.getElementById("prevBtn");
const nextBtn = document.getElementById("nextBtn");
const progressBar = document.getElementById("progressBar");
const songTitle = document.getElementById("songTitle");
const songList = document.getElementById("songList");




function loadSong(index, autoplay=false) {
  currentSongIndex = index;
  audio.src = songs[index].file;
  songTitle.textContent = songs[index].title;
  if (autoplay) playSong();
}

function playSong() {
  audio.play();
  isPlaying = true;
  playBtn.innerHTML = '<i class="bi bi-pause-fill"></i>';
}

function pauseSong() {
  audio.pause();
  isPlaying = false;
  playBtn.innerHTML = '<i class="bi bi-play-fill"></i>';
}

function nextSong() {
  loadSong((currentSongIndex + 1) % songs.length, true);
}
function prevSong() {
  loadSong((currentSongIndex - 1 + songs.length) % songs.length, true);
}

playBtn.onclick = () => isPlaying ? pauseSong() : playSong();
nextBtn.onclick = nextSong;
prevBtn.onclick = prevSong;

audio.addEventListener("timeupdate", () => {
  const progress = (audio.currentTime / audio.duration) * 100;
  progressBar.style.width = `${progress}%`;
});

audio.addEventListener("ended", nextSong);

// build dropup list
songs.forEach((s, idx) => {
  const li = document.createElement("li");
  const btn = document.createElement("button");
  btn.className = "dropdown-item";
  btn.textContent = s.title;
  btn.onclick = () => loadSong(idx, true);
  li.appendChild(btn);
  songList.appendChild(li);
});

// random autoplay when "game starts"
function startMusic() {
  const randomIndex = Math.floor(Math.random() * songs.length);
  loadSong(randomIndex, true);
}

// stop music when "back" clicked
function stopMusic() {
  audio.pause();
  audio.currentTime = 0;
  isPlaying = false;
  playBtn.innerHTML = '<i class="bi bi-play-fill"></i>';
}
/*

//Music Player 
const musicList = [
  {src: "sounds/song1.mp3", title: "Candy Beats 1"},
  {src: "sounds/song2.mp3", title: "Candy Beats 2"},
  {src: "sounds/song3.mp3", title: "Candy Beats 3"}
];

let currentTrackIndex = 0;
const audioPlayer = document.getElementById("audioPlayer");
const playPauseBtn = document.getElementById("playPauseBtn");
const nextBtn = document.getElementById("nextBtn");
const prevBtn = document.getElementById("prevBtn");
const musicTitle = document.getElementById("trackInfo");
const progressBar = document.getElementById("progress");
let isPlaying = false;

// --- Load Track ---
function loadTrack(index) {
  currentTrackIndex = index;
  audioPlayer.src = musicList[currentTrackIndex].src;
  musicTitle.textContent = musicList[currentTrackIndex].title;
}

// --- Play / Pause ---
function togglePlayPause() {
  if (isPlaying) {
    audioPlayer.pause();
    playPauseBtn.innerHTML = '<i class="bi bi-play-fill"></i>';
  } else {
    audioPlayer.play();
    playPauseBtn.innerHTML = '<i class="bi bi-pause-fill"></i>';
  }
  isPlaying = !isPlaying;
}

// --- Next / Prev ---
function playNext() {
  currentTrackIndex = (currentTrackIndex + 1) % musicList.length;
  loadTrack(currentTrackIndex);
  audioPlayer.play();
  isPlaying = true;
  playPauseBtn.innerHTML = '<i class="bi bi-pause-fill"></i>';
}

function playPrev() {
  currentTrackIndex = (currentTrackIndex - 1 + musicList.length) % musicList.length;
  loadTrack(currentTrackIndex);
  audioPlayer.play();
  isPlaying = true;
  playPauseBtn.innerHTML = '<i class="bi bi-pause-fill"></i>';
}

// --- Progress Bar ---
audioPlayer.addEventListener("timeupdate", () => {
  if (audioPlayer.duration) {
    const percent = (audioPlayer.currentTime / audioPlayer.duration) * 100;
    progressBar.style.width = percent + "%";
  }
});

// --- Auto Next Track ---
audioPlayer.addEventListener("ended", playNext);

// --- Button Events ---
playPauseBtn.onclick = togglePlayPause;
nextBtn.onclick = playNext;
prevBtn.onclick = playPrev;

// --- Initialize ---
loadTrack(currentTrackIndex);*/
</script>

</body>
</html>
